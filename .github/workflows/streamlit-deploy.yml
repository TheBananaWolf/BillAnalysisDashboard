name: 🎯 Deploy to Streamlit Cloud

on:
  push:
    branches: [ main ]
  workflow_dispatch:  # Allow manual triggers

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: 📥 Checkout repository
      uses: actions/checkout@v5

    - name: 🐍 Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: 📦 Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: 🔍 Validate Streamlit app
      run: |
        # Check if main.py can be imported
        python -c "
        import sys
        sys.path.append('.')
        try:
            exec(open('main.py').read())
            print('✅ Streamlit app validation successful!')
        except SystemExit:
            print('✅ Streamlit app loaded (SystemExit is expected)')
        except Exception as e:
            print(f'❌ Streamlit app validation failed: {e}')
            exit(1)
        "

    - name: 📋 Check Streamlit Cloud setup
      run: |
        echo "## 🎯 Streamlit Cloud Deployment Status" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # Check if Streamlit URL is configured
        if [ -n "${{ vars.STREAMLIT_SHARING_URL }}" ]; then
          echo "### ✅ Streamlit Cloud Connected!" >> $GITHUB_STEP_SUMMARY
          echo "- **App URL**: [${{ vars.STREAMLIT_SHARING_URL }}](${{ vars.STREAMLIT_SHARING_URL }})" >> $GITHUB_STEP_SUMMARY
          echo "- **Repository**: ${{ github.repository }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Auto-deploy**: Enabled ✅" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "🎉 **Your app will auto-deploy on every push to main!**" >> $GITHUB_STEP_SUMMARY
        else
          echo "### ⚠️ Streamlit Cloud Not Connected" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**To enable auto-deployment, follow these steps:**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "1. 🌐 Go to [share.streamlit.io](https://share.streamlit.io/)" >> $GITHUB_STEP_SUMMARY
          echo "2. 🔗 Connect your GitHub account" >> $GITHUB_STEP_SUMMARY
          echo "3. 📁 Select repository: \`${{ github.repository }}\`" >> $GITHUB_STEP_SUMMARY
          echo "4. 🎯 Set main file: \`main.py\`" >> $GITHUB_STEP_SUMMARY
          echo "5. ⚙️ Set Python version: \`3.11\`" >> $GITHUB_STEP_SUMMARY
          echo "6. 🚀 Click Deploy!" >> $GITHUB_STEP_SUMMARY
          echo "7. 📝 Copy the app URL and add as \`STREAMLIT_SHARING_URL\` variable in repo settings" >> $GITHUB_STEP_SUMMARY
        fi
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### 📋 Current Configuration:" >> $GITHUB_STEP_SUMMARY
        echo "- ✅ Python: 3.11" >> $GITHUB_STEP_SUMMARY
        echo "- ✅ Main file: \`main.py\`" >> $GITHUB_STEP_SUMMARY
        echo "- ✅ Requirements: \`requirements.txt\`" >> $GITHUB_STEP_SUMMARY
        echo "- ✅ Repository: Public" >> $GITHUB_STEP_SUMMARY

    - name: ✅ Deployment ready
      run: |
        echo "🎉 Repository is ready for Streamlit Cloud deployment!"
        echo "📍 Repository: ${{ github.repository }}"
        echo "📂 Main file: main.py"
        echo "🐍 Python version: 3.11"
        echo "📦 Dependencies: $(wc -l < requirements.txt) packages"