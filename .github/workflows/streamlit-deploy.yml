name: ğŸ¯ Deploy to Streamlit Cloud

on:
  push:
    branches: [ main ]
  workflow_dispatch:  # Allow manual triggers

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v5

    - name: ğŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: ğŸ“¦ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: ğŸ” Validate Streamlit app
      run: |
        # Check if main.py can be imported
        python -c "
        import sys
        sys.path.append('.')
        try:
            exec(open('main.py').read())
            print('âœ… Streamlit app validation successful!')
        except SystemExit:
            print('âœ… Streamlit app loaded (SystemExit is expected)')
        except Exception as e:
            print(f'âŒ Streamlit app validation failed: {e}')
            exit(1)
        "

    - name: ğŸ“‹ Check Streamlit Cloud setup
      run: |
        echo "## ğŸ¯ Streamlit Cloud Deployment Status" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        # Check if Streamlit URL is configured
        if [ -n "${{ vars.STREAMLIT_SHARING_URL }}" ]; then
          echo "### âœ… Streamlit Cloud Connected!" >> $GITHUB_STEP_SUMMARY
          echo "- **App URL**: [${{ vars.STREAMLIT_SHARING_URL }}](${{ vars.STREAMLIT_SHARING_URL }})" >> $GITHUB_STEP_SUMMARY
          echo "- **Repository**: ${{ github.repository }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Auto-deploy**: Enabled âœ…" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ğŸ‰ **Your app will auto-deploy on every push to main!**" >> $GITHUB_STEP_SUMMARY
        else
          echo "### âš ï¸ Streamlit Cloud Not Connected" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**To enable auto-deployment, follow these steps:**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "1. ğŸŒ Go to [share.streamlit.io](https://share.streamlit.io/)" >> $GITHUB_STEP_SUMMARY
          echo "2. ğŸ”— Connect your GitHub account" >> $GITHUB_STEP_SUMMARY
          echo "3. ğŸ“ Select repository: \`${{ github.repository }}\`" >> $GITHUB_STEP_SUMMARY
          echo "4. ğŸ¯ Set main file: \`main.py\`" >> $GITHUB_STEP_SUMMARY
          echo "5. âš™ï¸ Set Python version: \`3.11\`" >> $GITHUB_STEP_SUMMARY
          echo "6. ğŸš€ Click Deploy!" >> $GITHUB_STEP_SUMMARY
          echo "7. ğŸ“ Copy the app URL and add as \`STREAMLIT_SHARING_URL\` variable in repo settings" >> $GITHUB_STEP_SUMMARY
        fi
        
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ğŸ“‹ Current Configuration:" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Python: 3.11" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Main file: \`main.py\`" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Requirements: \`requirements.txt\`" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Repository: Public" >> $GITHUB_STEP_SUMMARY

    - name: âœ… Deployment ready
      run: |
        echo "ğŸ‰ Repository is ready for Streamlit Cloud deployment!"
        echo "ğŸ“ Repository: ${{ github.repository }}"
        echo "ğŸ“‚ Main file: main.py"
        echo "ğŸ Python version: 3.11"
        echo "ğŸ“¦ Dependencies: $(wc -l < requirements.txt) packages"